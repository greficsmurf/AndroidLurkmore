package com.app.lurkmoarapp

import com.app.lurkmoarapp.parser.ParseSection
import com.app.lurkmoarapp.parser.Parser
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.flow.collect
import kotlinx.coroutines.test.runBlockingTest
import org.junit.Before
import org.junit.Test

class ParserTest {

    private lateinit var parser: Parser
    private val string = "{{locked|all}}\n{{nohate}}\n<!--M\$Office, OO.org — для офисной работы (К. О.), а TeX для научных статей, дипломов и диссертаций. -->\n[[Файл:Nerd-46422.jpg|thumb|Типичный пользователь {{TeX}}а]]\n'''{{TeX}}''' —\nязык для вёрстки текста с применением научного подхода, для серьёзных людей.\n{{L^TeX}} — макросы для {{TeX}}'а. {{TeX}} был изобретён и внедрён в умы нердов винрарнейшим программистом/математиком [[:w:Кнут, Дональд|Дональдом Кнутом]] — если не отцом, то во всяком случае дедушкой всего нынешнего программирования. Он специально заточен под набор текста, состоящего на большую часть из формул, теорем и доказательств, таким образом, не предназначен для офисного использования. Что характерно, формулы получаются красивее вордовых. При этом процесс создания итогового документа состоит из двух частей:\n* Набор некоего кода, состоящего только из текста\n* Компиляция этого дела в документ.\n\n== So what? ==\n{{Q|Читать математический текст, набранный в MS Word, и общаться с человеком с обгрызенными ногтями в равной степени неприятно|ЖЖ}}\n[[Файл:Auctex.png|thumb|Вот так это выглядит при редактировании.]]\n[[Файл:Latex-output.png|thumb|А это — конечный результат.]]\n[[Файл:Preview-screenshot.png|thumb|Формулы — не помеха!]]\nТакой подход отличает {{TeX}} от [[Word]]'а, в котором формулы вставляются не специальной командой в тексте, а кликом мышки. Командами в {{TeX}} задаётся всё — от стилей оформления всего документа до выделения слов. При компиляции {{TeX}} превращает эти команды в красивый документ, набранный по всем правилам типографской вёрстки. Знаете ли вы, какое максимальное количество символов должно быть на одной строке? А что в математической формуле следует выделять курсивом? А как правильно расставлять переносы в выровненном в обе стороны тексте? Смешно? Ворд это тоже делает? Лососните тунца, алгоритм переноса в {{TeX}} был темой диссертации. Специально для школия: это ''очень'' сложно. В {{TeX}} всё это делается автоматически. И что самое удивительное, {{TeX}} значительно ускоряет процесс — потому, что предоставляет юзеру возможность сосредоточиться на содержании текста, забивая на оформление, и все равно получить охуенское оформление.\n\nПодход, используемый в Ворде и его клонах, называется WYSIWYG — What you see is what you get, «что видим, то и получаем». Понятно, что [[Тупая пизда|секретарша]], делающая отступы в начале абзаца пробелами, не имеет представления о всех тонкостях типографской вёрстки. Поэтому документы, набранные в WYSIWYG-редакторах, без дополнительной не-WYSIWYG-обработки обычно похожи на говно. Главный недостаток WYSIWYG в том, что при помощи пробелов в нём всё-таки можно худо-бедно хоть как-то отформатировать текст, а в {{TeX}} — нельзя. Секретарши негодуют.\n\nУ {{TeX}} в наличии такие приятные фичи, как автонумерация рисунков/таблиц/формул/библиографии, автоматическое оформление по заранее заданным правилам, удобнейшая работа с перекрёстными ссылками и библиографией и прочая автоматизация, гигантское число дополнительных пакетов на все случаи жизни (удобнее, чем в Bорде, если осилить мануалы). Еще прилагается стабильность работы и отсутствие геморроя с форматами и платформами. А также бесплатность и [[RMS|open source]], разумеется.\n\n== Меметичность ==\nСвященная война «{{L^TeX}} vs WYSIWYG» является дисциплиной специальной олимпиады. Каждый технарь, которому приходилось набирать что-либо серьёзное, знаком с {{TeX}}ом. Если человеку неинтересно, насколько красиво и качественно представлены результаты его труда, то вряд ли он делал что-то осмысленнее скачивания рефератов из интернета с одной-единственной целью «отъебитесь уже от меня, наконец».\n\nКроме того, этот холивар является частью стандартного срача «[[Linux]] vs [[Windows]]», так как часто с ТеХом знакомятся и осознают его православность параллельно с переходом на Linux. При этом {{TeX}} совершенно спокойно работает и с мелко-мягкими, просто средний пользователь винды о нем не знает.\n\n== Лулзы ==\nА лулзы начинаются при попытке вставить растровое изображение в документ. Впрочем, это лечится конвертацией в другие форматы и однократным гугленьем.\n\nВторая порция начинается, когда желанный журнал тупо выкладывает шаблон статьи в Ворде и его не волнует — при этом ходят слухи, что сотрудники редакции потом самолично перебивают информацию в {{L^TeX}}. Расово верные же журналы принимают статьи в *{{TeX}} и вообще в чем угодно, но потом за перевод «чего угодно» в *{{TeX}} берут деньги.\n\nОдна из канонiчных книг по {{TeX}} называется '''The joy of {{TeX}}''', что является отсылкой к не менее канонiчной '''The joy of SEX''' и, несомненно, символизирует.\n\n== На уютном ==\nНа нашем уютненьком луркморчике когда-то можно было невозбранно заюзать {{TeX}} с помощью тега &lt;math&gt;, однако потом эту возможность убрали с какой-то целью. Говорят, чтобы снять лишнюю нагрузку с сервера. Но мы-то знаем…\n\n== Троллинг {{TeX}}нарей ==\nВсе {{TeX}}ники, или {{TeX}}нари, очень болезненно относятся к произношению названия своей любимой системы верстки. Стоит только прочитать {{TeX}}, или еще хуже {{L^TeX}} cо звонким «КС» в конце, как вам гарантировано доставят тонны гневной копипасты и лулзов.\n\nПример:\n{{Цитата|pre=1|> Да, лучше латексом, но и ОО может.\n\nбалда! Латекс ты себе на член натягиваешь перед сексом, а LaTeX -- это Латех! :D|source=[http://lorquotes.ru/view-quote.php?id=164 Отсюда]}}\n\nПо версии самого Дональда Кнута, последняя буква в этом слове — заглавная χ, греческая [[:w:Хи_(буква)|буква «хи»]]. Кнут в своей книжке «[http://ru.wikipedia.org/wiki/Служебная:BookSources/5845903823 The TeXBook]» пишет, что ''при правильном произнесении слова TeX ваш монитор должен слегка запотеть''.\n\nЧто интересно, автор {{L^TeX}} Лесли Лэмпорт в своей книге «LATEX: a document preparation system» вполне допускает и такое прочтение.\n\n== См. также ==\n* Львовский, «[http://www.mccme.ru/free-books/llang/newllang.pdf Набор и вёрстка в системе LaTeX]»\n* Наиболее полный дистрибутив/livecd [http://www.tug.org/texlive TeX Live]\n* Специальный дистрибутив для вендузятников [http://miktex.org/ MiKTeX]\n\n\n{{Языки программирования}}\n{{SO}}\n{{Матан||{{TeX}} выражает [[матан]]}}\n\n[[Категория:ЛОР]]\n[[Категория:Матчасть]]\n\n[[w:TeX]]\n[[en.w:TeX]]"
    private val testStr = "Еще прилагается стабильность работы и отсутствие геморроя с форматами и платформами. А также бесплатность и [[RMS|open source]], разумеется.\\n\\n== Меметичность ==\\nСвященная война «{{L^TeX}} vs WYSIWYG» является дисциплиной специальной олимпиады. Каждый технарь, которому приходилось набирать что-либо серьёзное, знаком с {{TeX}}ом. Если человеку неинтересно, насколько красиво и качественно представлены результаты его труда, то вряд ли он делал что-то осмысленнее скачивания рефератов из интернета с одной-единственной целью «отъебитесь уже от меня, наконец».\\n\\nКроме того, этот холивар является частью стандартного срача «[[Linux]] vs [[Windows]]», так как часто с ТеХом знакомятся и осознают его православность параллельно с переходом на Linux. При этом {{TeX}} совершенно спокойно работает и с мелко-мягкими, просто средний пользователь винды о нем не знает.\\n\\n== Лулзы ==\\nА лулзы начинаются при попытке вставить растровое изображение в документ. Впрочем, это лечится конвертацией в другие форматы и однократным гугленьем.\\n\\nВторая порция начинается, когда желанный журнал тупо выкладывает шаблон статьи в Ворде и его не волнует — при этом ходят слухи, что сотрудники редакции потом самолично перебивают информацию в {{L^TeX}}."
    @Before
    fun before(){
        parser = Parser(string, listOf(ParseSection("so what?")))
    }

    @ExperimentalCoroutinesApi
    @Test
    fun testParse() = runBlockingTest {
        parser.toSpannableHtmlFlow().collect{
            println(it.toString())
        }
    }

}